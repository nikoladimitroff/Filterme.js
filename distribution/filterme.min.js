"use strict";var Color=function(){function n(n,t,i){this.r=n;this.g=t;this.b=i}function i(n){var u=Math.min(Math.min(n.r,n.g),n.b),t=Math.max(Math.max(n.r,n.g),n.b),i=t-u,r,f,e;if(f=(t-u)/2,i==0)r=0,e=0;else{e=f<.5?i/(t+u):i/(2-t-u);var o=((t-n.r)/6+i/2)/i,s=((t-n.g)/6+i/2)/i,h=((t-n.b)/6+i/2)/i;n.r==t?r=h-s:n.g==t?r=1/3+o-h:n.b==t&&(r=2/3+s-o);r<0&&(r+=1);r>1&&(r-=1)}return{h:r,s:e,L:f}}function r(i,r,u){var o,s,h,e,f;return r==0?(o=u*255,s=u*255,h=u*255):(f=u<.5?u*(1+r):u+r-r*u,e=2*u-f,o=255*t(e,f,i+1/3),s=255*t(e,f,i),h=255*t(e,f,i-1/3)),new n(o,s,h)}function t(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),6*i<1)?n+(t-n)*6*i:2*i<1?t:3*i<2?n+(t-n)*(2/3-i)*6:n}return n.basicColors={white:new n(255,255,255),black:new n(0,0,0),red:new n(255,0,0),green:new n(0,255,0),blue:new n(0,0,255)},n.grayscaleAlgorithms={arithmeticMean:0,geometricMean:1},n.areTooDifferentPerComponent=function(n,t,i){return i=i||.1*255,Math.abs(n.r-t.r)>=i||Math.abs(n.g-t.g)>=i||Math.abs(n.b-t.b)>=i},n.lerp=function(t,i,r){return new n(t.r*(1-r)+i.r*r,t.g*(1-r)+i.g*r,t.b*(1-r)+i.b*r)},n.fromHsl=function(n,t,i){return r(n,t,i)},n.prototype.toHsl=function(){return i(this)},n.prototype.calculateLength=function(){return Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b)},n.prototype.calculateDistanceTo=function(n){return Math.sqrt((this.r-n.r)*(this.r-n.r)+(this.g-n.g)*(this.g-n.g)+(this.b-n.b)*(this.b-n.b))},n.prototype.toGrayscale=function(t){switch(t){case n.grayscaleAlgorithms.arithmeticMean:return(this.r+this.g+this.b)/3;case n.grayscaleAlgorithms.geometricMean:return~~(this.calculateLength()/n.basicColors.white.calculateLength()*255);default:throw new RangeError("No such algorithm exists");}},n.prototype.invert=function(){return new n(255-this.r,255-this.g,255-this.b)},n.prototype.perComponentMultiply=function(t){return new n(this.r*t.r,this.g*t.g,this.b*t.b)},n.prototype.scalarMultiply=function(t){return new n(this.r*t,this.g*t,this.b*t)},n.prototype.add=function(t){return new n(this.r+t.r,this.g+t.g,this.b+t.b)},n.prototype.substract=function(t){return new n(this.r-t.r,this.g-t.g,this.b-t.b)},n.prototype.clamp=function(){this.r=Math.min(Math.max(0,this.r),255);this.g=Math.min(Math.max(0,this.g),255);this.b=Math.min(Math.max(0,this.b),255)},n}(),ImageDataHelper=function(){function n(n){this.imageData=n;this.data=n.data}return n.prototype.arrayCoordinatesToXY=function(n){var t=n/4,i=~~(t%this.imageData.width),r=~~(t/this.imageData.width);return{x:i,y:r}},n.prototype.xyToArrayCoordinate=function(n,t){return(n+this.imageData.width*t)*4},n.prototype.getAreaColors=function(n){for(var t,u=[],i=this.data,r=0;r<n.length;r++)t=n[r],u.push(new Color(i[t],i[t+1],i[t+2]));return u},n.prototype.getNeighbours=function(n){var f=this.arrayCoordinatesToXY(n),i=f.x,r=f.y,s=this.data,e=this.imageData.width,o=this.imageData.height,t=this.xyToArrayCoordinate(i,r),u=[t];return i>0&&(t=this.xyToArrayCoordinate(i-1,r),u.push(t)),i<e-1&&(t=this.xyToArrayCoordinate(i+1,r),u.push(t)),r>0&&(t=this.xyToArrayCoordinate(i,r+1),u.push(t)),r<o-1&&(t=this.xyToArrayCoordinate(i,r-1),u.push(t)),u},n.prototype.getExtendedVirtualNeighbours=function(n,t){for(var f,i,r,o=this.arrayCoordinatesToXY(n),u={row:o.y-~~(t/2),col:o.x-~~(t/2)},s=[],h=this.imageData.height,c=this.imageData.width,e=u.row;e<u.row+t;e++)for(f=u.col;f<u.col+t;f++)i=e,r=f,i<0?i=0:i>h-1&&(i=h-1),r<0?r=0:r>c-1&&(r=c-1),s.push(this.xyToArrayCoordinate(r,i));return s},n.prototype.colorAt=function(n){return new Color(this.data[n],this.data[n+1],this.data[n+2])},n.prototype.antialias=function(){for(var u,f,o,r=this.data,e=0;e<r.length;e+=4){var t=e,i=imageDataHelper.getAreaColors(imageDataHelper.getNeighbours(t)),n=new Color(0,0,0);for(u=0;u<i.length;u++)f=i[u],n.r+=f.r,n.g+=f.g,n.b+=f.b;o=imageDataHelper.colorAt(t);n.r/=i.length;n.g/=i.length;n.b/=i.length;Color.areTooDifferentPerComponent(n,o)&&(r[t]=n.r,r[t+1]=n.g,r[t+2]=n.b)}},n}(),Utilities=function(){function t(){var i=document.createElement("canvas"),r=i.getContext("2d"),u=r.getImageData(0,0,2,2),n=new ArrayBuffer(u.data.length),e=new Uint8ClampedArray(n),f=new Uint32Array(n),t;return f[1]=168496141,t=!0,n[4]===10&&n[5]===11&&n[6]===12&&n[7]===13&&(t=!1),t}var n={};return Object.defineProperty(n,"isCpuLittleEndian",{writeable:!1,value:t()}),n}(),Filter=function(){function n(){}return n.prototype.transformImage=function(){throw new TypeError("Method is abstract");},n}(),inheritClassFrom=function(n,t){n.prototype=new t;n.prototype.constructor=n},AdditiveFilter=function(){function n(n){if(n.constructor!=Color)throw new TypeError("color must be an instance of Color");this.color=n}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){for(var i=n.data,r=this.color,t=0;t<i.length;t+=4)i[t]+=r.r,i[t+1]+=r.g,i[t+2]+=r.b},n}(),BlendFilter=function(){function n(n,t){var u,r,i;if(n.constructor!=Array)throw new TypeError("filters must be an array");if(t){if(t.constructor!=Array)throw new TypeError("weights must be an array");}else for(t=[],u=1/n.length,i=0;i<n.length;i++)t.push(u);for(r=0,i=0;i<t.length;i++)r+=t[i];for(i=0;i<t.length;i++)t[i]/=r;this.filters=n;this.weights=t}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){var i=n.data,o=i.length/4,r=[],e,f,t,u;for(r=new Uint8Array(i.length),e=new Uint8Array(i.length),e.set(i),this.filters[0].transformImage(n),t=0;t<i.length;t+=4)u=n.colorAt(t).scalarMultiply(this.weights[0]),r[t]+=u.r,r[t+1]+=u.g,r[t+2]+=u.b,r[t+3]=255;for(i.set(e),f=1;f<this.filters.length;f++){for(this.filters[f].transformImage(n),t=0;t<i.length;t+=4)u=n.colorAt(t).scalarMultiply(this.weights[f]),r[t]+=u.r,r[t+1]+=u.g,r[t+2]+=u.b;i.set(e)}i.set(r)},n}(),ColorSwapFilter=function(){function n(n,t,i,r){if(n.constructor!=Color)throw new TypeError("color1 must be a instance of Color");if(t.constructor!=Color)throw new TypeError("color2 must be a instance of Color");if(i.constructor!=Number||i<=0)throw new TypeError("predicateThreshold must be a positive number");this.color1=n;this.color2=t;this.predicateThreshold=i;this.usePerComponentPredicate=Boolean(r)}return inheritClassFrom(n,Filter),n.prototype.targetColorPredicate=function(n,t){return this.usePerComponentPredicate?!Color.areTooDifferentPerComponent(n,t,this.predicateThreshold):n.calculateDistanceTo(t)<=this.predicateThreshold},n.prototype.transformImage=function(n){for(var r,i=n.data,t=0;t<i.length;t+=4)r=n.colorAt(t),this.targetColorPredicate(this.color1,r)&&(i[t]=this.color2.r,i[t+1]=this.color2.g,i[t+2]=this.color2.b),this.targetColorPredicate(this.color2,r)&&(i[t]=this.color1.r,i[t+1]=this.color1.g,i[t+2]=this.color1.b)},n}(),ConvolutionFilter=function(){function n(n){if(n.constructor!=ConvolutionKernel)throw new TypeError("kernel must be an instance of ConvolutionKernel");this.kernel=n}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){for(var f,r,e=n.data.length/4,u=n.data,i=[],t=0;t<e;t++)f=this.kernel.multiplyImageAt(t*4,n),i.push(f);for(r=0,t=0;t<i.length;t++)r=t*4,u[r]=i[t].r,u[r+1]=i[t].g,u[r+2]=i[t].b},n}(),ConvolutionKernel=function(){function n(n,t){if(n.constructor!=Array)throw new TypeError("data must be an array of numbers");var i=Math.sqrt(n.length);if(i!=~~i)throw new RangeError("data must be a square matrix");this.kernel=n;this.size=i;this.bias=t||0}return n.prototype.multiplyImageAt=function(n,t){var f,i,r,u;if(t.constructor!=ImageDataHelper)throw new TypeError("imageDataHelper must be an instance of ImageDataHelper");for(f=t.getAreaColors(t.getExtendedVirtualNeighbours(n,this.size)),i=new Color(0,0,0),r=0;r<f.length;r++)u=f[r].scalarMultiply(this.kernel[r]),i.r+=u.r,i.g+=u.g,i.b+=u.b;return i.r+=this.bias,i.g+=this.bias,i.b+=this.bias,i},n.prototype.normalize=function(){for(var t=0,n=0;n<this.kernel.length;n++)t+=this.kernel[n];for(n=0;n<this.kernel.length;n++)this.kernel[n]/=t},Object.defineProperty(n,"predefinedKernels",{writable:!1,value:{}}),Object.defineProperties(n.predefinedKernels,{identity:{writable:!1,value:new n([0,0,0,0,1,0,0,0,0])},brighten:{writable:!1,value:new n([10])},sharpen:{writable:!1,value:new n([-1,-1,-1,-1,9,-1,-1,-1,-1])},emboss:{writable:!1,value:new n([-1,-1,0,-1,0,1,0,1,1],128)},coloredEdgeDetection:{writable:!1,value:new n([1,1,1,1,-7,1,1,1,1])},edgeDetectionMedium:{writable:!1,value:new n([0,1,0,1,-4,1,0,1,0])},edgeDetectionHard:{writable:!1,value:new n([-1,-1,-1,-1,8,-1,-1,-1,-1])},blur:{writable:!1,value:new n([0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])},gaussian:{writable:!1,value:new n([67e-8,2292e-8,.00019117,.00038771,.00019117,2292e-8,67e-8,2292e-8,.00078634,.00655965,.01330373,.00655965,.00078633,2292e-8,.00019117,.00655965,.05472157,.11098164,.05472157,.00655965,.00019117,.00038771,.01330373,.11098164,.22508352,.11098164,.01330373,.00038771,.00019117,.00655965,.05472157,.11098164,.05472157,.00655965,.00019117,2292e-8,.00078633,.00655965,.01330373,.00655965,.00078633,2292e-8,67e-8,2292e-8,.00019117,.00038771,.00019117,2292e-8,67e-8])}}),n.computeGaussianBlurKernel=function(t){for(var i,f,h=Math.PI,e=t/6,t=t|1,r=~~(t/2),o=2*e*e,c=1/(h*o),s=[],u=r;u>-r-1;u--)for(i=-r;i<r+1;i++)s.push(c*Math.exp(-(i*i+u*u)/o));return f=new n(s),f.normalize(),f},n.computeLightnessModifyingKernel=function(t){return new n([t])},n.motionBlurDirections={topToBottom:0,leftToRight:1,topLeftToBottomRight:2,bottomLeftToTopRight:3},n.computeMotionBlur=function(t,i){var f,r,h,o,c,e,l,u,s;if(t%2==0)throw new RangeError("Kernel size must be an odd number");switch(i){case n.motionBlurDirections.topToBottom:f=function(n){return[n-t,n+t]};break;case n.motionBlurDirections.leftToRight:f=function(n){var i=t*~~(n/t);return[(n-1)%t+i,(n+1)%t+i]};break;case n.motionBlurDirections.topLeftToBottomRight:f=function(n){return[n-t-1,n+t+1]};break;case n.motionBlurDirections.bottomLeftToTopRight:f=function(n){return[n-t+1,n+t-1]};break;default:throw new RangeError("Direction must be chosen amongst ConvolotionKernel.motionBlurDirections");}for(r=[],h=t*t,o=0;o<h;o++)r[o]=0;for(c=(t*t-1)/2,e=[c];e.length!=0;)l=e.pop(),u=f(l),r[u[0]]==0&&(r[u[0]]=1,e.push(u[0])),r[u[1]]==0&&(r[u[1]]=1,e.push(u[1]));return s=new n(r),s.normalize(),s},n.prototype.prettyPrint=function(){for(var i,t,n=0;n<this.size;n++){for(i="",t=0;t<this.size;t++)i+=this.kernel[n*this.size+t].toFixed(3)+", ";console.log(i)}},n.predefinedKernels.blur.normalize(),n}(),GrayscaleFilter=function(){function n(n){this.grayscaleAlgo=n||Color.grayscaleAlgorithms.arithmeticMean}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){for(var r,u,i=n.data,t=0;t<i.length;t+=4)r=n.colorAt(t),u=r.toGrayscale(this.grayscaleAlgo),i[t]=i[t+1]=i[t+2]=u},n}(),InvertFilter=function(){function n(){}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){for(var r,i=n.data,t=0;t<i.length;t+=4)r=n.colorAt(t).invert(),i[t]=r.r,i[t+1]=r.g,i[t+2]=r.b},n}(),LayeredFilter=function(){function n(n){if(n.constructor!=Array)throw new TypeError("filters must be an array of filters");this.filters=n}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){for(var i=this.filters,t=0;t<i.length;t++)i[t].transformImage(n)},n}(),PixelizeFilter=function(){function n(n){if(n.constructor!=Number)throw new TypeError("level must be an instance of Number");this.level=~~n}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){var i,r,t;n=n||new ImageDataHelper;var f=n.data,s=4*this.level,h=~~(this.level/2);for(i=0;i<n.imageData.width;i+=this.level)for(r=0;r<n.imageData.height;r+=this.level){var o=n.xyToArrayCoordinate(i,r),e=n.colorAt(o),u=n.getExtendedVirtualNeighbours(o,this.level);for(t=0;t<u.length;t++)f[u[t]]=e.r,f[u[t]+1]=e.g,f[u[t]+2]=e.b}},n}(),RotateFilter=function(){function n(n){if(n.constructor!=Number)throw new TypeError("angle must be a number");var t=Math.cos(n),i=Math.sin(n);Object.defineProperties(this,{cosine:{get:function(){return t},enumerable:!1},sine:{get:function(){return i},enumerable:!1}});Object.defineProperty(this,"angle",{get:function(){return n},set:function(r){n=r||0;t=Math.cos(n);i=Math.sine(n)}})}return inheritClassFrom(n,Filter),n.prototype.transformImage=function(n){for(var a,o,r=n.data,i=[],u=this.sine,f=this.cosine,s=n.imageData.width/2,h=n.imageData.height/2,t=0;t<r.length;t+=4){var e=n.arrayCoordinatesToXY(t),c=f*e.x-u*e.y+(s-f*s+u*h),l=u*e.x+f*e.y+(h-u*s-f*h);c=~~c;l=~~l;a=n.colorAt(n.xyToArrayCoordinate(c,l));i.push(a)}for(t=0;t<i.length;t++)o=t*4,r[o]=i[t].r,r[o+1]=i[t].g,r[o+2]=i[t].b},n}(),EmphasizeColorFilter=function(){function n(n,t,i,r){if(n.constructor!=Color)throw new TypeError("targetColor must be a instance of Color");if(t.constructor!=Number||t<=0)throw new TypeError("predicateThreshold must be a positive number");this.targetColor=n;this.predicateThreshold=t;this.grayscaleAlgo=i||Color.grayscaleAlgorithms.arithmeticMean;this.usePerComponentPredicate=Boolean(r)}return inheritClassFrom(n,Filter),n.prototype.targetColorPredicate=function(n){return this.usePerComponentPredicate?Color.areTooDifferentPerComponent(this.targetColor,n,this.predicateThreshold):this.targetColor.calculateDistanceTo(n)>=this.predicateThreshold},n.prototype.transformImage=function(n){for(var r,u,i=n.data,t=0;t<i.length;t+=4)r=n.colorAt(t),this.targetColorPredicate(r)&&(u=r.toGrayscale(this.grayscaleAlgo),i[t]=i[t+1]=i[t+2]=u)},n}();
/*
//# sourceMappingURL=filterme.min.js.map
*/